<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Retrieving Full Taxonomy Lineage from NCBI with Python | Xin (David) Zhao </title> <meta name="author" content="Xin (David) Zhao"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-table@1.22.4/dist/bootstrap-table.min.css" integrity="sha256-uRX+PiRTR4ysKFRCykT8HLuRCub26LgXJZym3Yeom1c=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://davidzhao1015.github.io/blog/2025/retrieve-tax-lineage-API/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Xin</span> (David) Zhao </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Retrieving Full Taxonomy Lineage from NCBI with Python</h1> <p class="post-meta"> Created in August 09, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/taxonomy"> <i class="fa-solid fa-hashtag fa-sm"></i> taxonomy,</a>   <a href="/blog/tag/microbiome"> <i class="fa-solid fa-hashtag fa-sm"></i> microbiome,</a>   <a href="/blog/tag/biopython"> <i class="fa-solid fa-hashtag fa-sm"></i> biopython,</a>   <a href="/blog/tag/ncbi-api"> <i class="fa-solid fa-hashtag fa-sm"></i> ncbi-api</a>   ·   <a href="/blog/category/bioinformatics"> <i class="fa-solid fa-tag fa-sm"></i> bioinformatics</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="problem">Problem</h2> <p>In microbiome data analysis, taxonomy assignments—derived from marker genes or whole genomes—are essential for understanding microbial ecosystems when paired with abundance data. These assignments are not limited to single taxon names but are structured as hierarchical lineages across multiple taxonomic ranks, offering richer biological insights. However, researchers often only have partial taxonomy data (e.g., names at a single rank), which limits interpretability and analytical depth.<br><br></p> <h2 id="solution">Solution</h2> <p>To unlock the full potential of taxonomy-based insights, incomplete taxon names can be mapped to their complete hierarchical lineages by retrieving standardized taxonomy data from the NCBI database. This approach enriches the dataset and supports more robust biological interpretation.<br><br></p> <h2 id="background">Background</h2> <p>The <strong>NCBI Taxonomy</strong> is the official nomenclature and classification resource for the <strong>International Nucleotide Sequence Database Collaboration (INSDC)</strong>, which includes GenBank, EMBL, and DDBJ. It provides curated organism names and an approximately phylogenetic classification for all source organisms represented in INSDC records, serving as a framework for linking resources within NCBI and to external taxon-specific information. Names are selected by NCBI curators based on published taxonomic data and expert opinion, ensuring a single current name is assigned to each taxon. The database focuses on nomenclature and systematics rather than detailed taxon descriptions.<br><br></p> <h2 id="solution-implementation">Solution implementation</h2> <p>To retrieve full taxonomy lineages, one can use either the NCBI Taxonomy web browser or a programmatic method. The programmatic approach is highly efficient and advantageous, allowing automation of repetitive retrieval for multiple taxa at once. The NCBI E-utilities Python API enables access to the web server directly from Python scripts, integrating seamlessly with other steps in a microbiome data analysis pipeline.</p> <p>This section includes two parts:</p> <ol> <li>A reusable function to download and parse the full taxonomy lineage for a given taxon at a single rank.</li> <li>An example demonstrating how to apply this function to multiple taxa, using a food fermentation microbiome dataset as a case study.<br><br> </li> </ol> <h3 id="reusable-script">Reusable script</h3> <p>The customizable function below retrieves the full lineage using the Bio.Entrez.esearch(), Bio.Entrez.efetch(), and Bio.Entrez.read() functions from the <strong>Bio.Entrez</strong> submodule in the Biopython package.</p> <p>The input is a taxon string at a given rank, and the output is a list of taxa from higher to lower ranks. You can use this function as is or adapt it for your specific needs.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">Bio</span> <span class="kn">import</span> <span class="n">Entrez</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">os</span>


<span class="k">def</span> <span class="nf">get_taxonomy_lineage</span><span class="p">(</span><span class="n">taxon_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="sh">"</span><span class="s">Genus</span><span class="sh">"</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Fetches complete taxonomy lineage based on the known taxonomic level (the highest resolution available) from the NCBI taxonomy database.

    Args:
        rank (str): The taxonomic rank to search for (default is </span><span class="sh">"</span><span class="s">Genus</span><span class="sh">"</span><span class="s">). </span><span class="sh">"</span><span class="s">Family</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">Order</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">Class</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">Phylum</span><span class="sh">"</span><span class="s">, or </span><span class="sh">"</span><span class="s">Kingdom</span><span class="sh">"</span><span class="s"> can also be used.
        taxon_name (str): The name of the taxon to search for. If None, the function will not perform a search.
        email (str): Your email address for NCBI Entrez. This is required to track usage and for contact in case of issues.

    Returns:
        list: A list containing the lineage of the taxon, or None if not found.
        The lineage includes domain, kingdom (or clade), phylum, class, order, and family.
        If the taxon is not found, it returns None.
        If the rank is invalid, it returns None with an error message.
        If the taxon_name is None, it returns None with an error message.
    </span><span class="sh">"""</span>
    <span class="c1">#--- Set the email for NCBI Entrez ---
</span>    <span class="c1"># This is required by NCBI to track usage and for contact in case of issues
</span>    <span class="c1"># Replace with your email address
</span>    <span class="n">Entrez</span><span class="p">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span> <span class="ow">or</span> <span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">"</span><span class="s">NCBI_EMAIL</span><span class="sh">"</span><span class="p">)</span> 


    <span class="c1">#--- Input validation ---
</span>    <span class="c1"># Check if taxon_name is provided
</span>    <span class="k">if</span> <span class="n">taxon_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Taxon name is None. Please provide a valid taxon name.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="c1"># Check if rank is valid
</span>    <span class="k">if</span> <span class="n">rank</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="sh">"</span><span class="s">Genus</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Family</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Order</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Class</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Phylum</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Kingdom</span><span class="sh">"</span><span class="p">]:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Invalid rank: </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s">. Please use one of the following ranks: Genus, Family, Order, Class, Phylum, Kingdom.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>


    <span class="c1">#--- Search for the genus in the NCBI taxonomy database ---
</span>    <span class="c1"># The search term is formatted to include the genus name followed by "[Genus]" to specify the search field
</span>    <span class="c1"># This ensures that the search is limited to the genus level in the taxonomy database
</span>    <span class="n">handle</span> <span class="o">=</span> <span class="n">Entrez</span><span class="p">.</span><span class="nf">esearch</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="sh">"</span><span class="s">taxonomy</span><span class="sh">"</span><span class="p">,</span> <span class="n">term</span><span class="o">=</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">taxon_name</span><span class="si">}</span><span class="s">[</span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s">]</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">record</span> <span class="o">=</span> <span class="n">Entrez</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span> <span class="c1"># Read the search results
</span>    <span class="n">handle</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span> <span class="c1"># Close the handle to free resources
</span>

    <span class="c1">#--- Check if any IDs were found for the genus ---
</span>    <span class="c1"># If no IDs are found, print a message and return None
</span>    <span class="c1"># This is important to handle cases where the genus does not exist in the database
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">record</span><span class="p">[</span><span class="sh">"</span><span class="s">IdList</span><span class="sh">"</span><span class="p">]:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">No taxonomy ID found for </span><span class="si">{</span><span class="n">rank</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">taxon_name</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span> 
        <span class="k">return</span> <span class="bp">None</span>


    <span class="c1">#--- Fetch the taxonomy record using the first ID found ---
</span>    <span class="c1"># The first ID in the IdList is used to fetch the complete taxonomy record
</span>    <span class="c1"># This is because the search may return multiple IDs, but we are interested in the first one
</span>    <span class="c1"># The efetch function retrieves the record in XML format for easier parsing
</span>    <span class="c1"># The record contains detailed information about the taxonomy, including lineage
</span>    <span class="c1"># The lineage includes domain, kingdom (or clade), phylum, class, order, and family
</span>    <span class="n">taxid</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="sh">"</span><span class="s">IdList</span><span class="sh">"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Get the first taxonomy ID from the search results
</span>    <span class="n">handle</span> <span class="o">=</span> <span class="n">Entrez</span><span class="p">.</span><span class="nf">efetch</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="sh">"</span><span class="s">taxonomy</span><span class="sh">"</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">taxid</span><span class="p">,</span> <span class="n">retmode</span><span class="o">=</span><span class="sh">"</span><span class="s">xml</span><span class="sh">"</span><span class="p">)</span> 
    <span class="n">records</span> <span class="o">=</span> <span class="n">Entrez</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span> <span class="c1"># Read the fetched record
</span>    <span class="n">handle</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span> <span class="c1"># Close the handle to free resources
</span>
    <span class="c1">#--- Extract the lineage from the fetched record ---
</span>    <span class="c1"># The lineage is extracted from the first record in the list of records returned by efetch
</span>    <span class="c1"># The lineage is a string that includes the complete taxonomy hierarchy for the genus
</span>    <span class="c1"># It is formatted as "domain; kingdom; phylum; class; order; family"
</span>    <span class="n">lineage</span> <span class="o">=</span> <span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="sh">"</span><span class="s">Lineage</span><span class="sh">"</span><span class="p">]</span> <span class="c1"># Extract the lineage from the record, including domain, kingdom (or clade), phylum, class, order, and family
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">lineage</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">lineage_list</span> <span class="o">=</span> <span class="n">lineage</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">; </span><span class="sh">"</span><span class="p">)</span> <span class="c1"># Split the lineage into a list
</span>    
    <span class="k">return</span> <span class="n">lineage_list</span>
</code></pre></div></div> <p>Here’s a quick example to give you an idea of the output.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">genus</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Lactobacillus</span><span class="sh">"</span>
<span class="n">lineage</span> <span class="o">=</span> <span class="nf">get_taxonomy_lineage</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="sh">"</span><span class="s">Genus</span><span class="sh">"</span><span class="p">,</span> <span class="n">taxon_name</span><span class="o">=</span><span class="n">genus</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Lineage for </span><span class="si">{</span><span class="n">genus</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">lineage</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Lineage for Lactobacillus: ['cellular organisms', 'Bacteria', 'Bacillati', 'Bacillota', 'Bacilli', 'Lactobacillales', 'Lactobacillaceae']
</code></pre></div></div> <h3 id="example">Example</h3> <p>The example demonstrates applying the function to multiple bacterial taxa using loop iteration in Python, maximizing the efficiency of the Python API. You can adapt the code by replacing it with your own input data.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Define a list of target genera: Fermenting bacteria
</span><span class="n">genera</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Acetobacter</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Gluconacetobacter</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Lentibacillus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Brevibacterium</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Erwinia</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Enterobacter</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Pantoea</span><span class="sh">'</span><span class="p">,</span> 
          <span class="sh">'</span><span class="s">Kosakonia</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Lactobacillus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Companilactobacillus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Schleiferilactobacillus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Ligilactobacillus</span><span class="sh">'</span><span class="p">,</span> 
          <span class="sh">'</span><span class="s">Lactiplantibacillus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Loigolactobacillus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Paucilactobacillus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Limosilactobacillus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Fructilactobacillus</span><span class="sh">'</span><span class="p">,</span> 
          <span class="sh">'</span><span class="s">Acetilactobacillus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Secundilactobacillus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Lentilactobacillus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Carnobacterium</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Weissella</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Oenococcus</span><span class="sh">'</span><span class="p">,</span> 
          <span class="sh">'</span><span class="s">Enterococcus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Tetragenococcus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Streptococcus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Lactococcus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Pediococcus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Periweissella</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Leuconostoc</span><span class="sh">'</span><span class="p">,</span> 
          <span class="sh">'</span><span class="s">Marinilactobacillus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Alkalibacterium</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Eggerthella</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Propionibacterium</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Staphylococcus</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Kocuria</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Initialize an empty DataFrame to store all lineages
</span><span class="n">df_all_lineages</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">()</span>

<span class="c1"># Loop through each genus and get the taxonomy lineage
</span><span class="k">for</span> <span class="n">genus</span> <span class="ow">in</span> <span class="n">genera</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Processing genus: </span><span class="si">{</span><span class="n">genus</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">lineage</span> <span class="o">=</span> <span class="nf">get_taxonomy_lineage</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="sh">"</span><span class="s">Genus</span><span class="sh">"</span><span class="p">,</span> <span class="n">taxon_name</span><span class="o">=</span><span class="n">genus</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>  <span class="c1"># Sleep to avoid hitting NCBI's rate limits ~3 requests per second without API key
</span>    
    <span class="c1"># Skip if lineage is None or does not belong to Bacteria
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">lineage</span> <span class="ow">or</span> <span class="n">lineage</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="sh">"</span><span class="s">Bacteria</span><span class="sh">"</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Skipping genus: </span><span class="si">{</span><span class="n">genus</span><span class="si">}</span><span class="s"> (No lineage or not Bacteria)</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="c1"># Create a DataFrame for the current genus
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">df_genus_lineage</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">([</span><span class="n">lineage</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">Domain</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Kingdom</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Phylum</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Class</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Order</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Family</span><span class="sh">'</span><span class="p">])</span>
        <span class="n">df_genus_lineage</span><span class="p">[</span><span class="sh">'</span><span class="s">Genus</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">genus</span>
        
        <span class="c1"># Append to the main DataFrame
</span>        <span class="n">df_all_lineages</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">df_all_lineages</span><span class="p">,</span> <span class="n">df_genus_lineage</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error processing genus </span><span class="si">{</span><span class="n">genus</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Print summary of successful retrievals
</span><span class="n">genus_successful</span> <span class="o">=</span> <span class="n">df_all_lineages</span><span class="p">[</span><span class="sh">"</span><span class="s">Genus</span><span class="sh">"</span><span class="p">].</span><span class="nf">tolist</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">genus_successful</span><span class="p">)</span><span class="si">}</span><span class="s"> out of </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">genera</span><span class="p">)</span><span class="si">}</span><span class="s"> genera were successfully retrieved.</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Save the DataFrame to a CSV file
</span><span class="n">output_file</span> <span class="o">=</span> <span class="sh">"</span><span class="s">taxonomy_lineages.csv</span><span class="sh">"</span>
<span class="n">df_all_lineages</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Lineages saved to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Display the first few rows of the DataFrame
</span><span class="n">df_all_lineages</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div> <p>The first rows of the output table is as below.</p> <table> <thead> <tr> <th> </th> <th>Domain</th> <th>Kingdom</th> <th>Phylum</th> <th>Class</th> <th>Order</th> <th>Family</th> <th>Genus</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>Bacteria</td> <td>Pseudomonadati</td> <td>Pseudomonadota</td> <td>Alphaproteobacteria</td> <td>Acetobacterales</td> <td>Acetobacteraceae</td> <td>Acetobacter</td> </tr> <tr> <td>1</td> <td>Bacteria</td> <td>Pseudomonadati</td> <td>Pseudomonadota</td> <td>Alphaproteobacteria</td> <td>Acetobacterales</td> <td>Acetobacteraceae</td> <td>Gluconacetobacter</td> </tr> <tr> <td>2</td> <td>Bacteria</td> <td>Bacillati</td> <td>Bacillota</td> <td>Bacilli</td> <td>Bacillales</td> <td>Bacillaceae</td> <td>Lentibacillus</td> </tr> <tr> <td>3</td> <td>Bacteria</td> <td>Bacillati</td> <td>Actinomycetota</td> <td>Actinomycetes</td> <td>Micrococcales</td> <td>Brevibacteriaceae</td> <td>Brevibacterium</td> </tr> <tr> <td>4</td> <td>Bacteria</td> <td>Pseudomonadati</td> <td>Pseudomonadota</td> <td>Gammaproteobacteria</td> <td>Enterobacterales</td> <td>Erwiniaceae</td> <td>Erwinia</td> </tr> </tbody> </table> <p><br></p> <h2 id="conclusion">Conclusion</h2> <p>Taxonomic lineage information provides far more value than a single taxon name, especially in microbiome data analysis, where biological context is key. By programmatically retrieving complete lineages from NCBI’s Taxonomy database, researchers can enrich partial datasets, standardize taxonomic ranks, and gain deeper ecological insights without manual lookups.</p> <p>This workflow demonstrates how a few lines of Python, combined with the Bio.Entrez API, can turn scattered names into structured, multi-rank taxonomy data. Whether you are refining microbial community analyses or preparing results for publication, automating taxonomy retrieval not only saves time but also ensures reproducibility and accuracy.</p> <p>If you often work with incomplete taxonomy data, integrating such an automated retrieval step into your pipeline is a small effort with a high return in both interpretability and research efficiency.<br><br></p> <h3 id="reference">Reference</h3> <p><a href="https://www.ncbi.nlm.nih.gov/books/NBK53758/" rel="external nofollow noopener" target="_blank">NCBI help</a><br> <a href="https://biopython.org/docs/latest/Tutorial/chapter_entrez.html?utm_source=chatgpt.com" rel="external nofollow noopener" target="_blank">Bio.Entrez</a></p> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Xin (David) Zhao. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.22.4/dist/bootstrap-table.min.js" integrity="sha256-4rppopQE9POKfukn2kEvhJ9Um25Cf6+IDVkARD0xh78=" crossorigin="anonymous"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-publications",title:"publications",description:"publications by categories in reversed chronological order. generated by jekyll-scholar.",section:"Navigation",handler:()=>{window.location.href="/publications/"}},{id:"nav-projects",title:"projects",description:"A growing collection of cool projects.",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"nav-cv",title:"cv",description:"",section:"Navigation",handler:()=>{window.location.href="/cv/"}},{id:"dropdown-publications",title:"publications",description:"",section:"Dropdown",handler:()=>{window.location.href=""}},{id:"dropdown-projects",title:"projects",description:"",section:"Dropdown",handler:()=>{window.location.href=""}},{id:"dropdown-blog",title:"blog",description:"",section:"Dropdown",handler:()=>{window.location.href="/blog/"}},{id:"post-visualizing-microbiome-taxonomy-with-metacoder-in-r-a-step-by-step-guide",title:"Visualizing Microbiome Taxonomy with Metacoder in R: A Step-by-Step Guide",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2025/tax-heattree-r/"}},{id:"post-retrieving-full-taxonomy-lineage-from-ncbi-with-python",title:"Retrieving Full Taxonomy Lineage from NCBI with Python",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2025/retrieve-tax-lineage-API/"}},{id:"post-how-to-reconstruct-disease-onset-age-distributions-using-summary-statistics-a-rare-disease-use-case-in-python",title:"How to Reconstruct Disease Onset Age Distributions Using Summary Statistics: A Rare Disease...",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2025/reconstruct-age-distribution/"}},{id:"post-a-beginner-s-hands-on-guide-to-meta-analysis-and-confidence-intervals",title:"A Beginner\u2019s Hands-On Guide to Meta-Analysis and Confidence Intervals",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2025/meta-analysis-in-R/"}},{id:"post-evaluating-confidence-interval-methods-under-skewness-practical-insights-from-simulation",title:"Evaluating Confidence Interval Methods under Skewness: Practical Insights from Simulation",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2025/mean-interval-estimators/"}},{id:"post-comparing-methods-for-estimating-95-confidence-intervals-of-proportions-wald-wilson-and-equal-tailed-jeffreys-prior",title:"Comparing Methods for Estimating 95% Confidence Intervals of Proportions: Wald, Wilson, and Equal-Tailed...",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2025/benchmark-interval-prop/"}},{id:"post-modeling-diagnostic-delays-in-rare-disease-a-survival-analysis-case-study-in-python",title:"Modeling Diagnostic Delays in Rare Disease: A Survival Analysis Case Study in Python...",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2025/delay-diganosis-survival-analysis/"}},{id:"post-from-microbiology-to-bioinformatics-how-embracing-new-skills-transformed-my-career",title:"From Microbiology to Bioinformatics: How Embracing New Skills Transformed My Career",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2025/my-career-journey/"}},{id:"post-beyond-heatmaps-mapping-two-variables-with-plotly-in-public-health",title:"Beyond Heatmaps: Mapping Two Variables with Plotly in Public Health",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2025/plotly-maps-public-health/"}},{id:"post-how-to-import-excel-files-in-python",title:"How to Import Excel Files in Python",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/import-spreadsheet-python/"}},{id:"post-top-r-packages-for-go-enrichment-analysis-topgo-vs-globaltest-explained",title:"Top R Packages for GO Enrichment Analysis: topGO vs globaltest Explained",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/go-enrichment/"}},{id:"post-how-to-run-r-code-in-jupyter-notebook-within-vs-code-a-step-by-step-guide",title:"How to Run R Code in Jupyter Notebook within VS Code: A Step-by-Step...",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/R-kernel-jupyter/"}},{id:"post-how-to-perform-power-analysis-for-high-throughput-omics-data-using-sspa-a-guide-to-the-bioconductor-package",title:"How to Perform Power Analysis for High-Throughput Omics Data Using SSPA, A Guide...",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/power-analysis/"}},{id:"post-automating-reporting-with-rmarkdown",title:"Automating Reporting with RMarkdown",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/auto-reporting-rmarkdown/"}},{id:"post-introduction-to-linear-mixed-models-with-the-limma-package",title:"Introduction to Linear Mixed Models with the limma Package",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/linear-mixed-model/"}},{id:"post-choosing-the-right-dimensionality-reduction-in-metabolomics-navigating-common-pitfalls",title:"Choosing the Right Dimensionality Reduction in Metabolomics: Navigating Common Pitfalls",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/choose-dimension-reduction/"}},{id:"news-a-simple-inline-announcement",title:"A simple inline announcement.",description:"",section:"News"},{id:"news-a-long-announcement-with-details",title:"A long announcement with details",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_2/"}},{id:"news-a-simple-inline-announcement-with-markdown-emoji-sparkles-smile",title:'A simple inline announcement with Markdown emoji! <img class="emoji" title=":sparkles:" alt=":sparkles:" src="https://github.githubassets.com/images/icons/emoji/unicode/2728.png" height="20" width="20"> <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20">',description:"",section:"News"},{id:"projects-project-3-with-very-long-name",title:"project 3 with very long name",description:"a project that redirects to another website",section:"Projects",handler:()=>{window.location.href="/projects/3_project/"}},{id:"projects-project-4",title:"project 4",description:"another without an image",section:"Projects",handler:()=>{window.location.href="/projects/4_project/"}},{id:"projects-project-5",title:"project 5",description:"a project with a background image",section:"Projects",handler:()=>{window.location.href="/projects/5_project/"}},{id:"projects-project-6",title:"project 6",description:"a project with no image",section:"Projects",handler:()=>{window.location.href="/projects/6_project/"}},{id:"projects-project-7",title:"project 7",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/7_project/"}},{id:"projects-project-8",title:"project 8",description:"an other project with a background image and giscus comments",section:"Projects",handler:()=>{window.location.href="/projects/8_project/"}},{id:"projects-project-9",title:"project 9",description:"another project with an image \ud83c\udf89",section:"Projects",handler:()=>{window.location.href="/projects/9_project/"}},{id:"projects-gc-autofit-web-application-automating-and-accelerating-gc-ms-metabolomics",title:"GC-AutoFit: Web Application Automating and Accelerating GC-MS Metabolomics",description:"",section:"Projects",handler:()=>{window.location.href="/projects/gc-autofit/"}},{id:"projects-exploring-ames-housing-prices-a-data-driven-analysis",title:"Exploring Ames Housing Prices: A Data-Driven Analysis",description:"Exploratory data analysis for house price prediction, a Kaggle competition",section:"Projects",handler:()=>{window.location.href="/projects/house-price-prediction/"}},{id:"projects-impact-of-birth-factors-on-infant-gut-health-insights-from-a-microbiota-study",title:"Impact of Birth Factors on Infant Gut Health, Insights from a Microbiota Study...",description:"",section:"Projects",handler:()=>{window.location.href="/projects/infant_bifido_birth/"}},{id:"projects-predict-childhood-obesity-using-rf-xgboost-and-glmm-in-r",title:"Predict Childhood Obesity Using RF, XGBoost and GLMM in R",description:"",section:"Projects",handler:()=>{window.location.href="/projects/predict_obesity_machine_learning/"}},{id:"projects-vitamin-d-and-infant-gut-health-a-regression-analysis",title:"Vitamin D and Infant Gut Health, A Regression Analysis",description:"",section:"Projects",handler:()=>{window.location.href="/projects/vitD_infant_gut/"}},{id:"projects-wegan-web-application-streamlining-ecology-data-analysis",title:"WEGAN: Web Application Streamlining Ecology Data Analysis",description:"",section:"Projects",handler:()=>{window.location.href="/projects/wegan_web_app/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%64%61%76%69%64%7A%68%61%6F%31%30%31%35@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-google-scholar",title:"Google Scholar",section:"Socials",handler:()=>{window.open("https://scholar.google.com/citations?user=OVK0_oAAAAAJ&hl=en","_blank")}},{id:"socials-researchgate",title:"ResearchGate",section:"Socials",handler:()=>{window.open("https://www.researchgate.net/profile/Xin-Zhao-5/","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/davidzhao1015","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/davidxzhao","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>